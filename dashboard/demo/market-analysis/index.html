<!DOCTYPE html>
<html lang="tr">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Pazar Analizi (Demo) | Teknoify</title>

  <link href="https://fonts.googleapis.com/css2?family=Inter+Tight:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@400;500&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />

  <link rel="stylesheet" href="../../../../css/dashboard.css?v=8">
  <link rel="stylesheet" href="../../../../css/analysis.css?v=8">

  <link rel="stylesheet" href="./market-analysis.css?v=18">

  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
</head>

<body>

  <div id="contact-modal-overlay" class="tk-modal-overlay" onclick="closeContactModal()">
    <div class="tk-modal" onclick="event.stopPropagation()">
      <i class="fas fa-lock tk-modal-icon" style="color: #f97316;"></i>
      <div class="tk-modal-title">Eri≈üim Kƒ±sƒ±tlƒ±</div>
      <div class="tk-modal-text" id="contact-modal-text">Bu √∂zelliƒüi kullanabilmek i√ßin l√ºtfen bizimle ileti≈üime ge√ßin.</div>
      <div class="tk-modal-actions">
        <button class="tk-btn-cancel" onclick="closeContactModal()">Kapat</button>
        <button class="tk-btn-confirm" style="background: linear-gradient(135deg, #f97316, #ea580c); border:none;" onclick="window.open('https://teknoify.com/#contact', '_blank')">
          <i class="fas fa-envelope"></i> ƒ∞leti≈üime Ge√ß
        </button>
      </div>
    </div>
  </div>

  <div id="region-modal-overlay" class="tk-modal-overlay" style="z-index: 9998;" onclick="closeRegionModal()">
    <div class="tk-modal" style="max-width: 500px;" onclick="event.stopPropagation()">
      <div class="tk-modal-title" style="margin-bottom: 20px; font-size: 18px;">B√∂lge Se√ßimi & Harita √áizimi</div>
      <div class="region-grid">
        <div class="region-locked-item" onclick="openContactModal('ƒ∞l bazlƒ± geni≈ü harita taramasƒ± i√ßin bizimle ileti≈üime ge√ßin.')">
          <i class="fas fa-city"></i> ƒ∞l Se√ßiniz <i class="fas fa-lock lock-badge-sm"></i>
        </div>
        <div class="region-locked-item" onclick="openContactModal('ƒ∞l√ße bazlƒ± harita taramasƒ± i√ßin bizimle ileti≈üime ge√ßin.')">
          <i class="fas fa-map"></i> ƒ∞l√ße Se√ßiniz <i class="fas fa-lock lock-badge-sm"></i>
        </div>
        <div class="region-locked-item" onclick="openContactModal('Mahalle bazlƒ± detaylƒ± tarama i√ßin bizimle ileti≈üime ge√ßin.')">
          <i class="fas fa-map-pin"></i> Mahalle Se√ßiniz <i class="fas fa-lock lock-badge-sm"></i>
        </div>
        <div class="region-locked-item draw-btn" onclick="openContactModal('Harita √ºzerinde serbest b√∂lge √ßizimi (Polygon) i√ßin bizimle ileti≈üime ge√ßin.')">
          <i class="fas fa-draw-polygon"></i> Haritada √áiz <i class="fas fa-lock lock-badge-sm"></i>
        </div>
      </div>
      <div class="tk-modal-actions" style="margin-top: 25px;">
        <button class="tk-btn-cancel" onclick="closeRegionModal()">ƒ∞ptal</button>
      </div>
    </div>
  </div>

  <button id="floating-toggle-btn" onclick="toggleSidebar()" title="Paneli A√ß"><i class="fas fa-bars"></i></button>

  <aside class="sidebar">
    <div class="brand"><i class="fas fa-cube"></i> <span>Teknoify</span></div>
    <nav>
      <a href="/dashboard/member.html" class="menu-item" style="color: #94a3b8; background: rgba(255,255,255,0.03); border: 1px solid rgba(255,255,255,0.05); margin-top: 10px;">
        <i class="fas fa-arrow-left"></i> <span>Geri D√∂n</span>
      </a>
    </nav>
    <div class="menu-spacer"></div>
    <div class="sidebar-footer">
      <a href="#" onclick="logout()" class="btn-logout" title="√áƒ±kƒ±≈ü Yap"><i class="fas fa-sign-out-alt"></i> <span>√áƒ±kƒ±≈ü</span></a>
      <button class="btn-collapse" onclick="toggleSidebar()"><i class="fas fa-chevron-left"></i></button>
    </div>
  </aside>

  <main class="main-content">
    
    <header class="top-bar">
      <h2>Pazar Analizi <span class="premium-badge"><i class="fas fa-lock"></i> DEMO</span></h2>
      <div class="user-profile">
        <span id="user-name-display">Y√ºkleniyor...</span>
        <div class="avatar" id="user-avatar">U</div>
      </div>
    </header>

    <div class="content-scroll" style="padding-top: 10px;">

      <div style="display: flex; gap: 20px; margin-bottom: 24px; flex-wrap: wrap;">
        
        <div class="chart-box" style="flex: 2; min-width: 400px; padding: 0; overflow: hidden; position: relative;">
          <div style="padding: 20px; border-bottom: 1px solid rgba(255,255,255,0.05); display: flex; justify-content: space-between; align-items: center;">
            <h3 style="margin:0; font-size: 16px; color:#fff;">B√∂lge Rakip Analizi</h3>
            <span style="font-size: 12px; color: #64748b;"><i class="fas fa-map-marker-alt"></i> Fƒ±ndƒ±kzade, Fatih</span>
          </div>
          
          <div class="custom-map-controls">
            <button class="map-btn active" title="Haritayƒ± Kaydƒ±r (Aktif)" onclick="togglePan()"><i class="fas fa-hand-paper"></i></button>
            <div class="map-btn-divider"></div>
            <button class="map-btn locked" title="Yakƒ±nla≈ütƒ±rmak i√ßin ileti≈üime ge√ßin" onclick="openContactModal('Haritada geli≈ümi≈ü zoom √∂zelliƒüi i√ßin l√ºtfen bizimle ileti≈üime ge√ßin.')">
              <i class="fas fa-plus"></i><i class="fas fa-lock lock-badge"></i>
            </button>
            <button class="map-btn locked" title="Uzakla≈ütƒ±rmak i√ßin ileti≈üime ge√ßin" onclick="openContactModal('Haritada geli≈ümi≈ü zoom √∂zelliƒüi i√ßin l√ºtfen bizimle ileti≈üime ge√ßin.')">
              <i class="fas fa-minus"></i><i class="fas fa-lock lock-badge"></i>
            </button>
          </div>

          <div id="competitor-map" style="height: 380px; width: 100%; z-index: 1;"></div>
        </div>

        <div class="chart-box panel-scroll-container" style="flex: 1; min-width: 340px; padding: 0; height: 440px;">
          
          <div style="padding: 20px 20px 15px 20px; border-bottom: 1px solid rgba(255,255,255,0.05);">
            
            <div class="form-group">
              <label class="form-label">HARƒ∞TA T√úR√ú</label>
              <div class="tk-dropdown" onclick="toggleDropdown(this)">
                <div class="tk-dropdown-header">
                  <span>üìç B√∂lgesel Rakip Analizi</span>
                  <i class="fas fa-chevron-down"></i>
                </div>
                <div class="tk-dropdown-list">
                  <div class="tk-dropdown-item active">üìç B√∂lgesel Rakip Analizi</div>
                  <div class="tk-dropdown-item locked" onclick="event.stopPropagation(); openContactModal('N√ºfus Isƒ± Haritasƒ± verilerine eri≈ümek i√ßin l√ºtfen bizimle ileti≈üime ge√ßin.')">üî• N√ºfus Isƒ± Haritasƒ± <span><i class="fas fa-lock"></i></span></div>
                  <div class="tk-dropdown-item locked" onclick="event.stopPropagation(); openContactModal('Yaya Trafiƒüi Haritasƒ± verilerine eri≈ümek i√ßin l√ºtfen bizimle ileti≈üime ge√ßin.')">üö∂ Yaya Trafiƒüi Haritasƒ± <span><i class="fas fa-lock"></i></span></div>
                  <div class="tk-dropdown-item locked" onclick="event.stopPropagation(); openContactModal('B√∂lgesel Gelir Daƒüƒ±lƒ±mƒ± verilerine eri≈ümek i√ßin l√ºtfen bizimle ileti≈üime ge√ßin.')">üí∞ Gelir Daƒüƒ±lƒ±mƒ± Haritasƒ± <span><i class="fas fa-lock"></i></span></div>
                </div>
              </div>
            </div>

            <div class="form-group" style="margin-top: 15px;">
              <label class="form-label">SEKT√ñR</label>
              <div class="tk-dropdown" onclick="toggleDropdown(this)">
                <div class="tk-dropdown-header">
                  <span>üõí Hƒ±zlƒ± T√ºketim (FMCG)</span>
                  <i class="fas fa-chevron-down"></i>
                </div>
                <div class="tk-dropdown-list">
                  <div class="tk-dropdown-item active">üõí Hƒ±zlƒ± T√ºketim (FMCG)</div>
                  <div class="tk-dropdown-item locked" onclick="event.stopPropagation(); openContactModal('Teknoloji Perakendesi verilerine eri≈ümek i√ßin l√ºtfen bizimle ileti≈üime ge√ßin.')">üì± Teknoloji Perakendesi <span><i class="fas fa-lock"></i></span></div>
                  <div class="tk-dropdown-item locked" onclick="event.stopPropagation(); openContactModal('Giyim & Moda sekt√∂r√º verilerine eri≈ümek i√ßin l√ºtfen bizimle ileti≈üime ge√ßin.')">üëï Giyim & Moda <span><i class="fas fa-lock"></i></span></div>
                  <div class="tk-dropdown-item locked" onclick="event.stopPropagation(); openContactModal('Kafe & Restoran sekt√∂r√º verilerine eri≈ümek i√ßin l√ºtfen bizimle ileti≈üime ge√ßin.')">‚òï Kafe & Restoran <span><i class="fas fa-lock"></i></span></div>
                </div>
              </div>
            </div>

            <div class="form-group" style="margin-top: 15px;">
              <label class="form-label">B√ñLGE & LOKASYON</label>
              <button class="region-trigger-btn" onclick="openRegionModal()">
                <i class="fas fa-map-marked-alt"></i> Haritada B√∂lge Se√ß / √áizim Yap
              </button>
            </div>

            <div class="form-group" style="margin-top: 15px;">
              <label class="form-label">RAKƒ∞P SE√áƒ∞Nƒ∞Z (Fƒ∞LTRE)</label>
              <div class="tag-container">
                <span class="filter-tag active" style="border-color: #ef4444; color: #ef4444;">Bƒ∞M</span>
                <span class="filter-tag active" style="border-color: #06b6d4; color: #06b6d4;">A101</span>
                <span class="filter-tag active" style="border-color: #eab308; color: #eab308;">≈ûOK</span>
                <span class="filter-tag active" style="border-color: #f97316; color: #f97316;">Migros</span>
                <span class="filter-tag active" style="border-color: #3b82f6; color: #3b82f6;">Carrefour</span>
                <span class="filter-tag locked" onclick="openContactModal('Tarƒ±m Kredi Kooperatifleri maƒüaza verileri i√ßin bizimle ileti≈üime ge√ßin.')"><i class="fas fa-lock" style="font-size:10px;"></i> Tarƒ±m Kredi</span>
                <span class="filter-tag locked" onclick="openContactModal('File Market detaylƒ± verileri i√ßin bizimle ileti≈üime ge√ßin.')"><i class="fas fa-lock" style="font-size:10px;"></i> File</span>
                <span class="filter-tag locked" onclick="openContactModal('B√∂lgesel Yerel Zincir marketlerin verileri i√ßin bizimle ileti≈üime ge√ßin.')"><i class="fas fa-lock" style="font-size:10px;"></i> Yerel Zincirler</span>
              </div>
            </div>
          </div>

          <div style="padding: 20px;">
            
            <div class="ga-section">
              <div class="ga-section-title"><i class="fas fa-chart-pie" style="color:#f97316;"></i> PAZAR & REKABET</div>
              <div class="ga-list">
                <div class="ga-row">
                  <span class="ga-label">Maƒüaza Yoƒüunluƒüu <i class="far fa-question-circle help-icon" title="Se√ßili alandaki kilometrekare ba≈üƒ±na d√º≈üen rakip maƒüaza sayƒ±sƒ±"></i></span>
                  <span class="ga-leader"></span>
                  <span class="ga-val locked-val" onclick="openContactModal('Rakip maƒüaza yoƒüunluƒüu ve konsantrasyon verileri i√ßin l√ºtfen ileti≈üime ge√ßin.')">
                    <span class="blur">XX.X / km¬≤</span> <i class="fas fa-lock"></i>
                  </span>
                </div>
                <div class="ga-row">
                  <span class="ga-label">Konsantrasyon (HHI) <i class="far fa-question-circle help-icon" title="B√∂lgedeki tekelle≈üme ve rekabet yoƒüunluƒüu indeksi"></i></span>
                  <span class="ga-leader"></span>
                  <span class="ga-val locked-val" onclick="openContactModal('Rekabet konsantrasyon skoru (HHI) analizi i√ßin l√ºtfen ileti≈üime ge√ßin.')">
                    <span class="blur">0.XX (Orta)</span> <i class="fas fa-lock"></i>
                  </span>
                </div>
                <div class="ga-row">
                  <span class="ga-label">En Yakƒ±n Rakip (Median) <i class="far fa-question-circle help-icon" title="B√∂lgedeki maƒüazalarƒ±n birbirlerine olan ortalama uzaklƒ±ƒüƒ±"></i></span>
                  <span class="ga-leader"></span>
                  <span class="ga-val locked-val" onclick="openContactModal('Rakipler arasƒ± mesafe ve konum analizleri i√ßin l√ºtfen ileti≈üime ge√ßin.')">
                    <span class="blur">XXX metre</span> <i class="fas fa-lock"></i>
                  </span>
                </div>
                <div class="ga-row">
                  <span class="ga-label">Kapsama √áakƒ±≈ümasƒ± (10dk) <i class="far fa-question-circle help-icon" title="10 dakikalƒ±k y√ºr√ºme mesafesinde rakiplerin etki alanƒ± √ßakƒ±≈üma oranƒ±"></i></span>
                  <span class="ga-leader"></span>
                  <span class="ga-val locked-val" onclick="openContactModal('Servis alanƒ± ve kapsama √ßakƒ±≈ümasƒ± analizleri i√ßin l√ºtfen ileti≈üime ge√ßin.')">
                    <span class="blur">% XX Overlap</span> <i class="fas fa-lock"></i>
                  </span>
                </div>
              </div>
            </div>

            <div class="ga-section">
              <div class="ga-section-title"><i class="fas fa-shopping-basket" style="color:#f97316;"></i> Fƒ∞YAT & SEPET</div>
              <div class="ga-list">
                <div class="ga-row">
                  <span class="ga-label">Sepet Fiyat Endeksi <i class="far fa-question-circle help-icon" title="Rakip sepet maliyetinin 100 baz puan √ºzerinden endekslenmi≈ü hali"></i></span>
                  <span class="ga-leader"></span>
                  <span class="ga-val locked-val" onclick="openContactModal('Canlƒ± rakip sepet fiyat endeksi verileri i√ßin l√ºtfen ileti≈üime ge√ßin.')">
                    <span class="blur">XXX (%X)</span> <i class="fas fa-lock"></i>
                  </span>
                </div>
                <div class="ga-row">
                  <span class="ga-label">Sepet Kazanma Skoru <i class="far fa-question-circle help-icon" title="Temel √ºr√ºnlerde rakiplere kar≈üƒ± sepet ucuzluk √ºst√ºnl√ºƒü√º"></i></span>
                  <span class="ga-leader"></span>
                  <span class="ga-val locked-val" onclick="openContactModal('Sepet rekabet skoru ve kazanma metrikleri i√ßin l√ºtfen ileti≈üime ge√ßin.')">
                    <span class="blur">XX / 100</span> <i class="fas fa-lock"></i>
                  </span>
                </div>
                <div class="ga-row">
                  <span class="ga-label">ƒ∞ndirim Derinliƒüi (Ort) <i class="far fa-question-circle help-icon" title="B√∂lgede uygulanan ortalama raf ve kampanya indirimi y√ºzdesi"></i></span>
                  <span class="ga-leader"></span>
                  <span class="ga-val locked-val" onclick="openContactModal('Rakip indirim ve kampanya derinlik analizleri i√ßin l√ºtfen ileti≈üime ge√ßin.')">
                    <span class="blur">% XX.X</span> <i class="fas fa-lock"></i>
                  </span>
                </div>
                <div class="ga-row">
                  <span class="ga-label">Fiyat Volatilitesi (30g) <i class="far fa-question-circle help-icon" title="Son 30 g√ºn i√ßinde fiyatƒ± deƒüi≈üen √ºr√ºnlerin ortalama oranƒ±"></i></span>
                  <span class="ga-leader"></span>
                  <span class="ga-val locked-val" onclick="openContactModal('30 g√ºnl√ºk fiyat deƒüi≈üim volatilitesi verisi i√ßin l√ºtfen ileti≈üime ge√ßin.')">
                    <span class="blur">% X Deƒüi≈üim</span> <i class="fas fa-lock"></i>
                  </span>
                </div>
              </div>
            </div>

            <div class="ga-section" style="margin-bottom: 0;">
              <div class="ga-section-title"><i class="fas fa-users" style="color:#f97316;"></i> M√ú≈ûTERƒ∞ & POTANSƒ∞YEL</div>
              <div class="ga-list">
                <div class="ga-row">
                  <span class="ga-label">Eri≈üilebilir N√ºfus (10dk) <i class="far fa-question-circle help-icon" title="Belirlenen lokasyona 10 dakikalƒ±k y√ºr√ºme mesafesindeki yerle≈üik n√ºfus"></i></span>
                  <span class="ga-leader"></span>
                  <span class="ga-val locked-val" onclick="openContactModal('B√∂lgesel n√ºfus ve demografi potansiyeli analizleri i√ßin l√ºtfen ileti≈üime ge√ßin.')">
                    <span class="blur">XX,XXX Ki≈üi</span> <i class="fas fa-lock"></i>
                  </span>
                </div>
                <div class="ga-row">
                  <span class="ga-label">Ki≈üi Ba≈üƒ± Rakip <i class="far fa-question-circle help-icon" title="B√∂lgedeki n√ºfusun toplam maƒüaza sayƒ±sƒ±na b√∂l√ºnmesiyle elde edilen veri"></i></span>
                  <span class="ga-leader"></span>
                  <span class="ga-val locked-val" onclick="openContactModal('Ki≈üi ba≈üƒ±na d√º≈üen rakip maƒüaza endeksi i√ßin l√ºtfen ileti≈üime ge√ßin.')">
                    <span class="blur">1 / XXXX</span> <i class="fas fa-lock"></i>
                  </span>
                </div>
                <div class="ga-row">
                  <span class="ga-label">Talep Proxy Skoru <i class="far fa-question-circle help-icon" title="√áevredeki hastane, okul, durak vb. etkenlere baƒülƒ± yapay zeka yaya talep skoru"></i></span>
                  <span class="ga-leader"></span>
                  <span class="ga-val locked-val" onclick="openContactModal('Yapay zeka destekli b√∂lgesel talep tahmin skoru i√ßin l√ºtfen ileti≈üime ge√ßin.')">
                    <span class="blur">X.X (Y√ºksek)</span> <i class="fas fa-lock"></i>
                  </span>
                </div>
              </div>
            </div>

          </div>
        </div>
        
      </div>

      <div class="kpi-grid">
        
        <div class="ga-card">
          <div class="ga-card-header">
            TAKƒ∞P EDƒ∞LEN AKTƒ∞F √úR√úN <i class="far fa-question-circle help-icon" title="Haritada se√ßili markalarƒ±n sistemde anlƒ±k izlenen √ºr√ºn √ße≈üitliliƒüi"></i>
          </div>
          <div class="ga-list">
            <div class="ga-row">
              <span class="ga-label"><span class="brand-dot bim"></span> Bƒ∞M</span>
              <span class="ga-leader"></span>
              <span class="ga-val locked-val" onclick="openContactModal('Markalara ait aktif takip edilen √ºr√ºn verileri i√ßin bizimle ileti≈üime ge√ßin.')">
                <span class="blur">XX.XXX</span> <i class="fas fa-lock"></i>
              </span>
            </div>
            <div class="ga-row">
              <span class="ga-label"><span class="brand-dot a101"></span> A101</span>
              <span class="ga-leader"></span>
              <span class="ga-val locked-val" onclick="openContactModal('Markalara ait aktif takip edilen √ºr√ºn verileri i√ßin bizimle ileti≈üime ge√ßin.')">
                <span class="blur">XX.XXX</span> <i class="fas fa-lock"></i>
              </span>
            </div>
            <div class="ga-row">
              <span class="ga-label"><span class="brand-dot sok"></span> ≈ûok</span>
              <span class="ga-leader"></span>
              <span class="ga-val locked-val" onclick="openContactModal('Markalara ait aktif takip edilen √ºr√ºn verileri i√ßin bizimle ileti≈üime ge√ßin.')">
                <span class="blur">XX.XXX</span> <i class="fas fa-lock"></i>
              </span>
            </div>
            <div class="ga-row">
              <span class="ga-label"><span class="brand-dot migros"></span> Migros</span>
              <span class="ga-leader"></span>
              <span class="ga-val locked-val" onclick="openContactModal('Markalara ait aktif takip edilen √ºr√ºn verileri i√ßin bizimle ileti≈üime ge√ßin.')">
                <span class="blur">XX.XXX</span> <i class="fas fa-lock"></i>
              </span>
            </div>
            <div class="ga-row">
              <span class="ga-label"><span class="brand-dot carrefour"></span> Carrefour</span>
              <span class="ga-leader"></span>
              <span class="ga-val locked-val" onclick="openContactModal('Markalara ait aktif takip edilen √ºr√ºn verileri i√ßin bizimle ileti≈üime ge√ßin.')">
                <span class="blur">XX.XXX</span> <i class="fas fa-lock"></i>
              </span>
            </div>
          </div>
        </div>

        <div class="ga-card">
          <div class="ga-card-header">
            ORTALAMA SEPET MALƒ∞YETƒ∞ <i class="far fa-question-circle help-icon" title="B√∂lgedeki temel t√ºketim √ºr√ºnlerinin ortalama sepet fiyatƒ±"></i>
          </div>
          <div class="ga-list">
            <div class="ga-row">
              <span class="ga-label"><span class="brand-dot bim"></span> Bƒ∞M</span>
              <span class="ga-leader"></span>
              <span class="ga-val locked-val" onclick="openContactModal('Rakiplerin g√ºncel ortalama sepet maliyetleri i√ßin bizimle ileti≈üime ge√ßin.')">
                <span class="blur">‚Ç∫ X.XXX</span> <i class="fas fa-lock"></i>
              </span>
            </div>
            <div class="ga-row">
              <span class="ga-label"><span class="brand-dot a101"></span> A101</span>
              <span class="ga-leader"></span>
              <span class="ga-val locked-val" onclick="openContactModal('Rakiplerin g√ºncel ortalama sepet maliyetleri i√ßin bizimle ileti≈üime ge√ßin.')">
                <span class="blur">‚Ç∫ X.XXX</span> <i class="fas fa-lock"></i>
              </span>
            </div>
            <div class="ga-row">
              <span class="ga-label"><span class="brand-dot sok"></span> ≈ûok</span>
              <span class="ga-leader"></span>
              <span class="ga-val locked-val" onclick="openContactModal('Rakiplerin g√ºncel ortalama sepet maliyetleri i√ßin bizimle ileti≈üime ge√ßin.')">
                <span class="blur">‚Ç∫ X.XXX</span> <i class="fas fa-lock"></i>
              </span>
            </div>
            <div class="ga-row">
              <span class="ga-label"><span class="brand-dot migros"></span> Migros</span>
              <span class="ga-leader"></span>
              <span class="ga-val locked-val" onclick="openContactModal('Rakiplerin g√ºncel ortalama sepet maliyetleri i√ßin bizimle ileti≈üime ge√ßin.')">
                <span class="blur">‚Ç∫ X.XXX</span> <i class="fas fa-lock"></i>
              </span>
            </div>
            <div class="ga-row">
              <span class="ga-label"><span class="brand-dot carrefour"></span> Carrefour</span>
              <span class="ga-leader"></span>
              <span class="ga-val locked-val" onclick="openContactModal('Rakiplerin g√ºncel ortalama sepet maliyetleri i√ßin bizimle ileti≈üime ge√ßin.')">
                <span class="blur">‚Ç∫ X.XXX</span> <i class="fas fa-lock"></i>
              </span>
            </div>
          </div>
        </div>

        <div class="ga-card">
          <div class="ga-card-header">
            √úR√úN PROMOSYONLARI <i class="far fa-question-circle help-icon" title="Takip edilen √ºr√ºnlerdeki aktif indirim ve promosyon hacmi"></i>
          </div>
          <div class="ga-list">
            <div class="ga-row">
              <span class="ga-label"><span class="brand-dot bim"></span> Bƒ∞M</span>
              <span class="ga-leader"></span>
              <span class="ga-val locked-val" onclick="openContactModal('Rakiplerin promosyon detaylarƒ± ve indirim oranlarƒ± i√ßin bizimle ileti≈üime ge√ßin.')">
                <span class="blur">XXX √úr√ºn (%X)</span> <i class="fas fa-lock"></i>
              </span>
            </div>
            <div class="ga-row">
              <span class="ga-label"><span class="brand-dot a101"></span> A101</span>
              <span class="ga-leader"></span>
              <span class="ga-val locked-val" onclick="openContactModal('Rakiplerin promosyon detaylarƒ± ve indirim oranlarƒ± i√ßin bizimle ileti≈üime ge√ßin.')">
                <span class="blur">XXX √úr√ºn (%X)</span> <i class="fas fa-lock"></i>
              </span>
            </div>
            <div class="ga-row">
              <span class="ga-label"><span class="brand-dot sok"></span> ≈ûok</span>
              <span class="ga-leader"></span>
              <span class="ga-val locked-val" onclick="openContactModal('Rakiplerin promosyon detaylarƒ± ve indirim oranlarƒ± i√ßin bizimle ileti≈üime ge√ßin.')">
                <span class="blur">XXX √úr√ºn (%X)</span> <i class="fas fa-lock"></i>
              </span>
            </div>
            <div class="ga-row">
              <span class="ga-label"><span class="brand-dot migros"></span> Migros</span>
              <span class="ga-leader"></span>
              <span class="ga-val locked-val" onclick="openContactModal('Rakiplerin promosyon detaylarƒ± ve indirim oranlarƒ± i√ßin bizimle ileti≈üime ge√ßin.')">
                <span class="blur">XXX √úr√ºn (%X)</span> <i class="fas fa-lock"></i>
              </span>
            </div>
            <div class="ga-row">
              <span class="ga-label"><span class="brand-dot carrefour"></span> Carrefour</span>
              <span class="ga-leader"></span>
              <span class="ga-val locked-val" onclick="openContactModal('Rakiplerin promosyon detaylarƒ± ve indirim oranlarƒ± i√ßin bizimle ileti≈üime ge√ßin.')">
                <span class="blur">XXX √úr√ºn (%X)</span> <i class="fas fa-lock"></i>
              </span>
            </div>
          </div>
        </div>

        <div class="ga-card">
          <div class="ga-card-header">
            ASSORTMENT SKORU <i class="far fa-question-circle help-icon" title="Markalarƒ±n kategori bazlƒ± √ºr√ºn bulunurluk ve √ße≈üitlilik skoru"></i>
          </div>
          <div class="ga-list">
            <div class="ga-row">
              <span class="ga-label"><span class="brand-dot bim"></span> Bƒ∞M</span>
              <span class="ga-leader"></span>
              <span class="ga-val locked-val" onclick="openContactModal('Rakiplerin √ºr√ºn √ße≈üitliliƒüi (Assortment) skoru i√ßin bizimle ileti≈üime ge√ßin.')">
                <span class="blur">XX / 100</span> <i class="fas fa-lock"></i>
              </span>
            </div>
            <div class="ga-row">
              <span class="ga-label"><span class="brand-dot a101"></span> A101</span>
              <span class="ga-leader"></span>
              <span class="ga-val locked-val" onclick="openContactModal('Rakiplerin √ºr√ºn √ße≈üitliliƒüi (Assortment) skoru i√ßin bizimle ileti≈üime ge√ßin.')">
                <span class="blur">XX / 100</span> <i class="fas fa-lock"></i>
              </span>
            </div>
            <div class="ga-row">
              <span class="ga-label"><span class="brand-dot sok"></span> ≈ûok</span>
              <span class="ga-leader"></span>
              <span class="ga-val locked-val" onclick="openContactModal('Rakiplerin √ºr√ºn √ße≈üitliliƒüi (Assortment) skoru i√ßin bizimle ileti≈üime ge√ßin.')">
                <span class="blur">XX / 100</span> <i class="fas fa-lock"></i>
              </span>
            </div>
            <div class="ga-row">
              <span class="ga-label"><span class="brand-dot migros"></span> Migros</span>
              <span class="ga-leader"></span>
              <span class="ga-val locked-val" onclick="openContactModal('Rakiplerin √ºr√ºn √ße≈üitliliƒüi (Assortment) skoru i√ßin bizimle ileti≈üime ge√ßin.')">
                <span class="blur">XX / 100</span> <i class="fas fa-lock"></i>
              </span>
            </div>
            <div class="ga-row">
              <span class="ga-label"><span class="brand-dot carrefour"></span> Carrefour</span>
              <span class="ga-leader"></span>
              <span class="ga-val locked-val" onclick="openContactModal('Rakiplerin √ºr√ºn √ße≈üitliliƒüi (Assortment) skoru i√ßin bizimle ileti≈üime ge√ßin.')">
                <span class="blur">XX / 100</span> <i class="fas fa-lock"></i>
              </span>
            </div>
          </div>
        </div>

      </div>

      <div class="chart-box" style="padding: 0; overflow: hidden; margin-bottom: 20px;">
        <div style="padding: 20px; border-bottom: 1px solid rgba(255,255,255,0.05);">
          <h3 style="margin:0; font-size: 16px; color:#fff;">Temel T√ºketim Fiyat Kar≈üƒ±la≈ütƒ±rmasƒ±</h3>
        </div>
        <table class="ma-table">
          <thead>
            <tr>
              <th style="width: 30%;">√úr√ºn Grubu</th>
              <th style="width: 20%;">Bizim Fiyat</th>
              <th style="width: 20%;">Rakip A (Min)</th>
              <th style="width: 15%;">Rakip B (Max)</th>
              <th style="width: 15%;">Pazar Farkƒ±</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td><i class="fas fa-egg" style="color:#888; margin-right:8px;"></i> Yumurta (30'lu L Boy)</td>
              <td>110.00 TL</td>
              <td>115.50 TL</td>
              <td>125.00 TL</td>
              <td class="status-down">- %4.7</td>
            </tr>
            <tr>
              <td><i class="fas fa-bread-slice" style="color:#888; margin-right:8px;"></i> Tost Ekmeƒüi (500g)</td>
              <td>35.50 TL</td>
              <td>32.00 TL</td>
              <td>39.90 TL</td>
              <td class="status-up">+ %10.9</td>
            </tr>
          </tbody>
        </table>
      </div>

    </div>
  </main>

  <script src="../../../config.js"></script>
  <script src="../../shared/auth.js?v=20260228"></script>
  
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script>
    document.addEventListener("DOMContentLoaded", function() {
      var map = L.map('competitor-map', {
        zoomControl: false, 
        dragging: true,     
        scrollWheelZoom: false, 
        doubleClickZoom: false, 
        touchZoom: false,
        attributionControl: false 
      }).setView([41.0075, 28.9350], 15); 

      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        className: 'dark-map-tiles'
      }).addTo(map);

      var worldBounds = [[-90, -180], [90, -180], [90, 180], [-90, 180]];
      var organicHole = [
        [41.0145, 28.9340], [41.0138, 28.9375], [41.0125, 28.9400], [41.0105, 28.9425],
        [41.0080, 28.9435], [41.0055, 28.9430], [41.0035, 28.9410], [41.0015, 28.9380],
        [40.9995, 28.9340], [40.9990, 28.9310], [41.0005, 28.9280], [41.0025, 28.9260],
        [41.0050, 28.9255], [41.0080, 28.9270], [41.0105, 28.9295], [41.0125, 28.9315]
      ];

      L.polygon([worldBounds, organicHole], {
        color: 'transparent',
        fillColor: '#0f172a',
        fillOpacity: 0.88
      }).addTo(map);

      const brandData = {
        "Migros": { logo: "https://www.google.com/s2/favicons?domain=migros.com.tr&sz=64", color: "#f97316" },
        "Carrefour": { logo: "https://www.google.com/s2/favicons?domain=carrefoursa.com&sz=64", color: "#3b82f6" },
        "Bƒ∞M": { logo: "https://www.google.com/s2/favicons?domain=bim.com.tr&sz=64", color: "#ef4444" },
        "A101": { logo: "https://www.google.com/s2/favicons?domain=a101.com.tr&sz=64", color: "#06b6d4" },
        "≈ûok": { logo: "https://cdn.worldvectorlogo.com/logos/sok-1.svg", color: "#eab308" }
      };

      function normalizeBrandName(rawName) {
          if (!rawName) return null;
          let n = rawName.toUpperCase();
          if (n.includes("Mƒ∞GROS") || n.includes("MIGROS")) return "Migros";
          if (n.includes("CARREFOUR")) return "Carrefour";
          if (n.includes("Bƒ∞M") || n.includes("BIM")) return "Bƒ∞M";
          if (n.includes("A101") || n.includes("A.101")) return "A101";
          if (n.includes("≈ûOK") || n.includes("SOK")) return "≈ûok";
          return null; 
      }

      function isInsidePolygon(point, polygon) {
          let x = point[0], y = point[1]; 
          let inside = false;
          for (let i = 0, j = polygon.length - 1; i < polygon.length; j = i++) {
              let xi = polygon[i][0], yi = polygon[i][1];
              let xj = polygon[j][0], yj = polygon[j][1];
              let intersect = ((yi > y) !== (yj > y)) && (x < (xj - xi) * (y - yi) / (yj - yi) + xi);
              if (intersect) inside = !inside;
          }
          return inside;
      }

      function renderMarker(lat, lng, brand, storeName) {
          if (brand && isInsidePolygon([lat, lng], organicHole)) {
              let brandInfo = brandData[brand];
              const customIcon = L.divIcon({
                className: 'custom-leaflet-icon',
                html: `
                  <div class="brand-logo-marker" style="border-color: ${brandInfo.color}; box-shadow: 0 0 10px ${brandInfo.color}80;">
                    <img src="${brandInfo.logo}" alt="${brand}" onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
                    <span class="fallback-text" style="color: ${brandInfo.color}">${brand.charAt(0)}</span>
                  </div>
                `,
                iconSize: [36, 36],
                iconAnchor: [18, 18],
                tooltipAnchor: [0, -20]
              });

              L.marker([lat, lng], { icon: customIcon })
                .bindTooltip(`<b>${brand}</b><br>${storeName}`)
                .addTo(map);
          }
      }

      const supplementaryStores = [
        { lat: 41.0081, lng: 28.9311, brand: "Bƒ∞M", name: "Bƒ∞M Altƒ±mermer" },
        { lat: 41.0125, lng: 28.9360, brand: "Bƒ∞M", name: "Bƒ∞M Bezmialem Mini" },
        { lat: 41.0134, lng: 28.9315, brand: "Bƒ∞M", name: "Bƒ∞M √áapa" },
        { lat: 41.0000, lng: 28.9305, brand: "Bƒ∞M", name: "Bƒ∞M S√ºmb√ºlefendi/Duhaniye" },
        { lat: 41.0002, lng: 28.9259, brand: "Bƒ∞M", name: "Bƒ∞M Hacƒ± Hamza" },
        { lat: 41.0025, lng: 28.9302, brand: "Bƒ∞M", name: "Bƒ∞M Hacƒ± Kadƒ±n" },
        { lat: 41.0090, lng: 28.9412, brand: "Bƒ∞M", name: "Bƒ∞M Haseki" },
        { lat: 41.0067, lng: 28.9318, brand: "Bƒ∞M", name: "Bƒ∞M Hekimoƒülu" },
        { lat: 41.0107, lng: 28.9390, brand: "Bƒ∞M", name: "Bƒ∞M Kƒ±zƒ±lelma" },
        { lat: 41.0032, lng: 28.9328, brand: "Bƒ∞M", name: "Bƒ∞M Kocamustafapa≈üa" },
        { lat: 41.0151, lng: 28.9293, brand: "Bƒ∞M", name: "Bƒ∞M Saray Mini" },
        { lat: 41.0160, lng: 28.9305, brand: "Bƒ∞M", name: "Bƒ∞M ≈ûehremini" },
        { lat: 41.0112, lng: 28.9297, brand: "Bƒ∞M", name: "Bƒ∞M Seyyid √ñmer" },
        { lat: 41.0040, lng: 28.9280, brand: "Bƒ∞M", name: "Bƒ∞M Silivrikapƒ±" },
        { lat: 41.0005, lng: 28.9295, brand: "Bƒ∞M", name: "Bƒ∞M S√ºmb√ºlefendi" },
        { lat: 41.0045, lng: 28.9340, brand: "Bƒ∞M", name: "Bƒ∞M Tiyatro Mini" },
        { lat: 41.0147, lng: 28.9401, brand: "Bƒ∞M", name: "Bƒ∞M Vatan (Oƒüuzhan)" },
        { lat: 41.0065, lng: 28.9352, brand: "≈ûok", name: "≈ûok Kƒ±zƒ±lelma" },
        { lat: 41.0055, lng: 28.9348, brand: "Carrefour", name: "Carrefour Mini" }
      ];

      supplementaryStores.forEach(store => renderMarker(store.lat, store.lng, store.brand, store.name));

      fetch('fatih-markets.geojson') 
        .then(response => response.json())
        .then(data => {
            data.features.forEach(feature => {
                let lng = feature.geometry.coordinates[0];
                let lat = feature.geometry.coordinates[1];
                let rawBrand = feature.properties.brand || feature.properties.name;
                let storeName = feature.properties.name || "Market ≈ûubesi";
                let brand = normalizeBrandName(rawBrand);
                renderMarker(lat, lng, brand, storeName);
            });
        })
        .catch(error => console.error("Market GeoJSON dosyasƒ± √ßekilirken hata olu≈ütu.", error));
    });

    function toggleDropdown(el) {
        document.querySelectorAll('.tk-dropdown').forEach(d => {
            if(d !== el) d.classList.remove('open');
        });
        el.classList.toggle('open');
    }

    document.addEventListener('click', function(e) {
        if(!e.target.closest('.tk-dropdown')) {
            document.querySelectorAll('.tk-dropdown').forEach(d => d.classList.remove('open'));
        }
    });

    function openContactModal(text) {
      closeRegionModal(); 
      const modal = document.getElementById("contact-modal-overlay");
      const modalText = document.getElementById("contact-modal-text");
      if(text) modalText.innerText = text;
      modal.classList.add("show");
    }

    function closeContactModal() {
      const modal = document.getElementById("contact-modal-overlay");
      modal.classList.remove("show");
    }

    function openRegionModal() {
      const modal = document.getElementById("region-modal-overlay");
      modal.classList.add("show");
    }

    function closeRegionModal() {
      const modal = document.getElementById("region-modal-overlay");
      modal.classList.remove("show");
    }

    function togglePan() {
       console.log("Pan modu aktif.");
    }
  </script>

</body>
</html>
